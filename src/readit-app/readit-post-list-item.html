<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/moment-element/moment-element.html">

<dom-module id="readit-post-list-item">
    <template>
    
        <style include="iron-flex shared-styles">
            :host {
                padding: 1rem;
                border-top: 1px solid rgba(1, 1, 1, 0.1)
            }
            .item {
                @apply --layout-horizontal;
                /*display: block;*/
            }
            .post-detail {
                @apply --layout-flex;
                margin-right: var(--spacing-sm)
            }
            .post-meta {
                @apply --layout-horizontal;
            }
            h1.post-title {
                font-size: var(--base-font-size);
                font-weight: var(--base-font-weight);
                margin-top: 0;
            }
            .post-meta span:not(:last-child) {
                margin-right: var(--spacing-sm);
            }
            .post-meta-item {
                font-size: 0.7em;
                color: rgba(1, 1, 1, 0.6);
            }
            .post-meta-item.score {
                padding: 0.5em 0
            }
            .post-voting {
                @apply --layout-vertical;
                @apply --layout-center;
                width: 2em;
            }
            iron-image {
                margin-right: var(--spacing-sm);
            }
        </style>

        <div class="item">
            <dom-if if="[[_isThisAURL(post.data.thumbnail)]]">
                <template>
                    <div class="post-image">
                        <iron-image style="width:80px; height:80px;" sizing="cover" src="[[post.data.thumbnail]]"></iron-image>
                    </div>
                </template>
            </dom-if>

            <div class="post-detail">
                <h1 class="post-title"><a href="/post/[[post.data.id]]">[[post.data.title]]</a></h1>
                <div class="post-meta">
                    <span class="post-meta-item">[[post.data.subreddit_name_prefixed]]</span>
                    <span class="post-meta-item">[[post.data.author]]</span>
                </div>
                <p class="post-meta-item">
                    [[_convertUnixTime(post.data.created)]]
                </p>
            </div>

            <div class="post-voting">
                <iron-icon class="arrow-upvote" icon="icons:arrow-upward"></iron-icon>
                <!--TODO: Simplify numbers. i.e. 2,600 becomes 2.6k-->
                <span class="post-meta-item score">[[post.data.score]]</span>
                <iron-icon class="arrow-downvote" icon="icons:arrow-downward"></iron-icon>
            </div>

        </div>

    </template>
    
    <script>
    class ReaditPostListItem extends Polymer.Element {
        static get is() { return "readit-post-list-item"; }
        static get properties () {
            return {
                post: {
                    type: Object,
                    value: () => { return {} }
                }
            }
        }
        /**
        * Converts Reddit's Unix timestamp to a human-readable format.
        */
        _convertUnixTime (timecode) {
            let theDate = new Date(timecode * 1000)
            return theDate.toLocaleString()
        }
        /**
        * Check to see if thumbnail string is a URL. 
        * Reddit will occasionally return a string with 'self', 
        * 'default' or some other junk in place of a URL.
        */
        _isThisAURL(obj) {
            let re = new RegExp("(http|https)://")
            if (re.test(obj)) {
                return true
            }
        }

    }
    customElements.define(ReaditPostListItem.is, ReaditPostListItem)
    </script>
    
</dom-module>